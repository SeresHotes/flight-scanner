# Flight Scanner V2 ‚úàÔ∏è

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–µ—à–µ–≤—ã—Ö –±–∏–ª–µ—Ç–æ–≤ —Å –ø—Ä–µ–±—ã–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö. –°–∫—Ä–∏–ø—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä—è–º—ã—Ö –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö –∏–∑ –≥–æ—Ä–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≥–æ—Ä–æ–¥–∞, –∞ –∑–∞—Ç–µ–º –∏–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –∫–æ–Ω–µ—á–Ω—ã–π –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–∏–±–∫–∏–π –ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- **–ü—Ä—è–º—ã–µ –ø–µ—Ä–µ–ª–µ—Ç—ã**: —Ç–æ–ª—å–∫–æ –±–µ—Å–ø–µ—Ä–µ—Å–∞–¥–æ—á–Ω—ã–µ —Ä–µ–π—Å—ã
- **–î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–∞—Ç**: –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- **–ê–Ω–∞–ª–∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–∞–º –∏ –≥–æ—Ä–æ–¥–∞–º

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- Poetry (–º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- API —Ç–æ–∫–µ–Ω –æ—Ç [Travelpayouts](https://www.travelpayouts.com/)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª—ã

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
poetry install
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
```

4. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `.env`:
```
TRAVELPAYOUTS_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `collect_flights.py` –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö:

```bash
poetry run python collect_flights.py <ORIGIN> <DESTINATION> \
  --leg1-dates <START_DATE> <END_DATE> \
  --leg2-dates <START_DATE> <END_DATE> \
  --intermediate <CITY1> [CITY2 ...]
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `ORIGIN` - –∫–æ–¥ –≥–æ—Ä–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (IATA)
- `DESTINATION` - –∫–æ–¥ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ (IATA)
- `--leg1-dates` - –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞ (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD)
- `--leg2-dates` - –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞ (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD)
- `--intermediate` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (IATA –∫–æ–¥—ã)
- `--currency` - –≤–∞–ª—é—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RUB)
- `--output` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –ü—Ä–∏–º–µ—Ä—ã:

**–ú–æ—Å–∫–≤–∞ ‚Üí –°—Ç–∞–º–±—É–ª/–î—É–±–∞–π ‚Üí –ë–∞–Ω–≥–∫–æ–∫:**
```bash
poetry run python collect_flights.py MOW BKK \
  --leg1-dates 2026-02-15 2026-02-20 \
  --leg2-dates 2026-02-25 2026-03-05 \
  --intermediate IST DXB
```

**–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ ‚Üí –°—Ç–∞–º–±—É–ª ‚Üí –ë–∞—Ä—Å–µ–ª–æ–Ω–∞:**
```bash
poetry run python collect_flights.py LED BCN \
  --leg1-dates 2026-03-01 2026-03-03 \
  --leg2-dates 2026-03-10 2026-03-15 \
  --intermediate IST
```

### –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `aggregate_flights.py` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
poetry run python aggregate_flights.py <INPUT_FILE> [OPTIONS]
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `INPUT_FILE` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `--min-stay` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `--max-stay` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)
- `--top` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—É—á—à–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `--output` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –ü—Ä–∏–º–µ—Ä—ã:

**–ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑:**
```bash
poetry run python aggregate_flights.py data/flights_MOW_BKK_20260215_120000.json
```

**–° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –Ω–∞ –ø—Ä–µ–±—ã–≤–∞–Ω–∏–µ (3-7 –¥–Ω–µ–π):**
```bash
poetry run python aggregate_flights.py data/flights_MOW_BKK_20260215_120000.json \
  --min-stay 3 --max-stay 7
```

**–í—ã–≤–æ–¥ —Ç–æ–ø-20 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:**
```bash
poetry run python aggregate_flights.py data/flights_MOW_BKK_20260215_120000.json \
  --top 20
```

**–° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```bash
poetry run python aggregate_flights.py data/flights_MOW_BKK_20260215_120000.json \
  --output results/best_combinations.json
```

## üó∫Ô∏è –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ IATA –∫–æ–¥—ã –≥–æ—Ä–æ–¥–æ–≤

### –†–æ—Å—Å–∏—è
- `MOW` - –ú–æ—Å–∫–≤–∞
- `LED` - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
- `KZN` - –ö–∞–∑–∞–Ω—å
- `SVX` - –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
- `AER` - –°–æ—á–∏

### –ï–≤—Ä–æ–ø–∞
- `IST` - –°—Ç–∞–º–±—É–ª
- `DXB` - –î—É–±–∞–π
- `BCN` - –ë–∞—Ä—Å–µ–ª–æ–Ω–∞
- `PAR` - –ü–∞—Ä–∏–∂
- `LON` - –õ–æ–Ω–¥–æ–Ω
- `ROM` - –†–∏–º
- `BER` - –ë–µ—Ä–ª–∏–Ω

### –ê–∑–∏—è
- `BKK` - –ë–∞–Ω–≥–∫–æ–∫
- `DXB` - –î—É–±–∞–π
- `SIN` - –°–∏–Ω–≥–∞–ø—É—Ä
- `HKT` - –ü—Ö—É–∫–µ—Ç
- `GOI` - –ì–æ–∞
- `DEL` - –î–µ–ª–∏

## üìä –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –§–∞–π–ª —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
```json
{
  "metadata": {
    "origin": "MOW",
    "destination": "BKK",
    "intermediate_airports": ["IST", "DXB"],
    "leg1_date_range": {...},
    "leg2_date_range": {...},
    "total_flights": 150
  },
  "leg1_flights": [...],
  "leg2_flights": [...]
}
```

### –§–∞–π–ª –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
```json
{
  "generated_at": "2026-02-15T12:00:00",
  "statistics": {
    "total_combinations": 45,
    "min_price": 35000,
    "avg_price": 45000,
    "median_price": 42000
  },
  "combinations": [...]
}
```

## üí° –°–æ–≤–µ—Ç—ã

1. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≥–æ—Ä–æ–¥–∞**: –≤—ã–±–∏—Ä–∞–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ö–∞–±—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–π—Å–æ–≤ (IST, DXB, AUH)
2. **–î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–∞—Ç**: —á–µ–º —à–∏—Ä–µ –¥–∏–∞–ø–∞–∑–æ–Ω, —Ç–µ–º –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –Ω–æ –¥–æ–ª—å—à–µ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
3. **Rate limiting**: —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
4. **–ü—Ä–µ–±—ã–≤–∞–Ω–∏–µ**: –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ 3-7 –¥–Ω–µ–π –¥–ª—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–µ–∑–¥–æ–∫

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
flight_scanner_v2/
‚îú‚îÄ‚îÄ collect_flights.py      # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ aggregate_flights.py    # –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ pyproject.toml          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Poetry
‚îú‚îÄ‚îÄ .env                    # API —Ç–æ–∫–µ–Ω (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îú‚îÄ‚îÄ .env.example            # –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞
‚îú‚îÄ‚îÄ .gitignore             # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ data/                  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## üêõ Troubleshooting

**–û—à–∏–±–∫–∞: "TRAVELPAYOUTS_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω

**–ù–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–π—Å–æ–≤:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å IATA –∫–æ–¥–æ–≤
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏–º–µ—é—Ç –ø—Ä—è–º—ã–µ —Ä–µ–π—Å—ã

**–°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:**
- –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë§ –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏.

---

**–ü—Ä–∏—è—Ç–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π! ‚úàÔ∏èüåç**
